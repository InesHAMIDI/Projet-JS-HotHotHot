<!DOCTYPE html>
<html lang="fr">
	<head>
		<title>HotHotHot project</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="whidth=device-width, initial-scale=1.0"/>
		<meta name="autor" content="DERRIVES angèle - GROSJEAN Florian - HAMIDI Inès - HASPEKIAN Yvan"/>
		<meta name="description" content="project HotHotHot"/>
		<meta name="keywords" content="HTML, CSS, javascript, projet, étudiants, aix, aix-en-provence, informatique, iut, dut, stagiaire, web, web dev, développement web, developpement web">
		<meta name="date" content="2022-02-25"/>
		<link id="Style" rel="stylesheet" href="style.css">
        <link rel="manifest" href="manifest.webmanifest">
        <script defer src="app.js"></script>
		<!-- <link rel="icon" href="assets/favicon.ico"/>  -->
		<script src="https://kit.fontawesome.com/4823553caa.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
	</head>

	<body>
		<nav>
        	<aside id="leftNav">
            	<div id="icon"><a href="#debut" onclick="closeLeftNav()" title="accueil"><i class="fas fa-home"></i></a></div>
        	    <div id="icon"><a href="doc.html" onclick="closeLeftNav()" title="documentation"><i class="fa fa-users"></i></a></div>
				<div id="icon"><a href="https://github.com/InesHAMIDI/Projet-JS-HotHotHot" target="_blank" onclick="closeLeftNav()" title="github"><i class="fab fa-github"></i></a></div>
				
                <br>
			</aside>
    	</nav> 

		<div id="texte">
			<p>on va mettre les capteurs ici hein</p>
		</div>
        <canvas id="graph"></canvas>
        
		<div id="sensors"></div>
        <script>

            function getTodaySensors(sensorData)
            {
                var todaySensors;

                for(let i = 0; i < sensorData.capteurs.length; i++)
                {
                    let sensorDate = new Date(sensorData.capteurs[i].Timestamp);
                    let currentDate = new Date(Date.now());

                    if(sensorDate.getFullYear() == currentDate.getFullYear() && sensorDate.getDate() == currentDate.getDate() && sensorDate.getDay() == currentDate.getDay())
                        todaySensors.add(sensorData.capteurs[i]);
                }
            }

            function readSensors(sensorData)
            {
                var sensors = document.getElementById("sensors");

                for(let i = 0; i < sensorData.capteurs.length; i++)
                {
                    let div          = document.createElement("div");
                    let p            = document.createElement("p");
                    let ul           = document.createElement("ul");
                    let sensorType   = document.createElement("li");
                    let localisation = document.createElement("li");
                    let value        = document.createElement("li");
                    let date         = document.createElement("li");

                    sensors.appendChild(div);
                    div.appendChild(p);
                    div.appendChild(ul);        
                    ul.appendChild(sensorType); 
                    ul.appendChild(localisation);
                    ul.appendChild(value);
                    ul.appendChild(date);

                    p.innerHTML            = "Capteur " + (i + 1);
                    sensorType.innerHTML   = "Type : " + sensorData.capteurs[i].type;
                    localisation.innerHTML = "Emplacement : " + sensorData.capteurs[i].Nom;
                    value.innerHTML        = "Valeur : " + sensorData.capteurs[i].Valeur;
                    date.innerHTML         = "Date : " + new Date(sensorData.capteurs[i].Timestamp).toDateString();
                }
            }

                console.log("Echec de la connexion au serveur WSS, utilisation de fetch");

                fetch('https://hothothot.dog/api/capteurs').then(function (response)
                {
                    return response.json();
                }).then(function (sensorData)
                {
                    readSensors(sensorData);
                    console.log(getTodaySensors(sensorData));
                }).catch(function (err)
                {
                    console.warn('Echec de fetch', err);
                });
            //}
        </script>

        <script src="graph.js"></script>
    </body>
</html>
